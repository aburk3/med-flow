generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PatientFlowStage {
  InitialContact
  FirstMeeting
  ScheduledSurgery
  PreOpClearance
  PostOpFollowUp
}

enum AppointmentStatus {
  completed
  canceled
  no_show
  rescheduled
  scheduled
}

enum PatientIntakeStatus {
  sent
  complete
  incomplete
}

enum AppointmentFlowStepStatus {
  not_started
  in_progress
  incomplete
  complete
}

enum PhysicianPrefix {
  Dr
  NursePractitioner
}

model Physician {
  id           String        @id @default(uuid()) @db.Uuid
  prefix       PhysicianPrefix @default(Dr)
  firstName    String        @map("first_name")
  lastName     String        @map("last_name")
  specialty    String
  location     String
  patients     Patient[]
  appointments Appointment[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("physicians")
}

model Patient {
  id                 String            @id @default(uuid()) @db.Uuid
  firstName          String            @map("first_name")
  lastName           String            @map("last_name")
  stage              PatientFlowStage
  dateOfBirth        DateTime          @map("date_of_birth") @db.Date
  phoneNumber        String            @map("phone_number")
  emergencyContact   String            @map("emergency_contact")
  intakeStatus       PatientIntakeStatus @default(sent) @map("intake_status")
  primaryPhysicianId String            @map("primary_physician_id") @db.Uuid
  primaryPhysician   Physician         @relation(fields: [primaryPhysicianId], references: [id])
  appointments       Appointment[]
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  @@index([primaryPhysicianId])
  @@map("patients")
}

model Appointment {
  id          String            @id @default(uuid()) @db.Uuid
  patientId   String            @map("patient_id") @db.Uuid
  physicianId String            @map("physician_id") @db.Uuid
  date        DateTime          @db.Timestamptz(3)
  type        String
  location    String
  status      AppointmentStatus
  patient     Patient           @relation(fields: [patientId], references: [id])
  physician   Physician         @relation(fields: [physicianId], references: [id])
  flow        AppointmentFlow?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@index([patientId])
  @@index([physicianId])
  @@index([date])
  @@index([status])
  @@map("appointments")
}

model AppointmentFlow {
  id            String               @id @default(uuid()) @db.Uuid
  appointmentId String               @unique @map("appointment_id") @db.Uuid
  appointment   Appointment          @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  steps         AppointmentFlowStep[]
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt

  @@map("appointment_flows")
}

model AppointmentFlowStep {
  id        String                  @id @default(uuid()) @db.Uuid
  flowId    String                  @map("flow_id") @db.Uuid
  flow      AppointmentFlow         @relation(fields: [flowId], references: [id], onDelete: Cascade)
  title     String
  order     Int
  status    AppointmentFlowStepStatus
  createdAt DateTime                @default(now())
  updatedAt DateTime                @updatedAt

  @@index([flowId])
  @@unique([flowId, order])
  @@map("appointment_flow_steps")
}
